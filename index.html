<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Codebreaker (Star & Hash)</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the Inter font and overall aesthetics */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
        }
        .container {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        .game-card {
            background-color: #ffffff;
            border-radius: 1.5rem; /* More rounded corners */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); /* Soft shadow */
            max-width: 500px;
            width: 100%;
            padding: 2rem;
            text-align: center;
            border: 1px solid #e2e8f0; /* Light border */
        }
        input[type="number"] {
            -moz-appearance: textfield; /* Remove spinner on Firefox */
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none; /* Remove spinner on Chrome, Safari, Edge */
            margin: 0;
        }
        .input-group input {
            width: 8rem; /* Wider input for 3-digit number */
            height: 3.5rem; /* Fixed height for number inputs */
            font-size: 1.5rem;
            text-align: center;
        }
        .btn {
            transition: all 0.2s ease-in-out;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            background-color: #f8fafc; /* Lighter background for history items */
            border-radius: 0.75rem;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .message-box {
            padding: 1rem;
            border-radius: 0.75rem;
            margin-top: 1rem;
            font-weight: bold;
        }
        .message-success {
            background-color: #d1fae5; /* Green for success */
            color: #065f46;
        }
        .message-error {
            background-color: #fee2e2; /* Red for error */
            color: #991b1b;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="container">
        <div class="game-card">
            <h1 class="text-3xl font-extrabold text-gray-800 mb-6">Digital Codebreaker</h1>
            <p class="text-gray-600 mb-8">
                Try to guess the three-digit secret number (from 100 to 999).<br>
                <span class="font-semibold text-green-600">Star (⭐)</span> = Correct digit in the correct position.<br>
                <span class="font-semibold text-yellow-600">Hash (#)</span> = Correct digit in the wrong position.
            </p>

            <div class="mb-6 input-group flex justify-center gap-4">
                <input type="number" id="guessInput" min="100" max="999" class="p-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 transition" placeholder="---" maxlength="3">
            </div>

            <div class="flex flex-col sm:flex-row justify-center gap-4 mb-6">
                <button id="guessButton" class="btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-xl shadow-md">
                    Guess
                </button>
                <button id="newGameButton" class="btn bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-8 rounded-xl shadow-md">
                    New Game
                </button>
            </div>

            <div id="messageBox" class="message-box hidden"></div>

            <h2 class="text-xl font-semibold text-gray-700 mt-8 mb-4">Guess History</h2>
            <div id="history" class="bg-gray-50 p-4 rounded-xl max-h-60 overflow-y-auto border border-gray-200">
                <!-- Guess history will be inserted here -->
                <p id="noHistoryMessage" class="text-gray-500">No attempts yet. Start guessing!</p>
            </div>
        </div>
    </div>

    <script>
        // Global variables for game state
        let secretCombination; // Now stores a single 3-digit number (e.g., 543)
        let attempts = 0;      // Counter for the number of attempts

        // Get references to HTML elements
        const guessInput = document.getElementById('guessInput'); // Single input field
        const guessButton = document.getElementById('guessButton');
        const newGameButton = document.getElementById('newGameButton');
        const historyDiv = document.getElementById('history');
        const messageBox = document.getElementById('messageBox');
        const noHistoryMessage = document.getElementById('noHistoryMessage');

        /**
         * Generates a random three-digit number between 100 and 999.
         * @returns {number} A random three-digit number.
         */
        function generateSecretCombination() {
            return Math.floor(Math.random() * (999 - 100 + 1)) + 100;
        }

        /**
         * Checks the user's guess against the secret combination for stars and hashes.
         * Star (⭐): Correct digit in the correct position.
         * Hash (#): Correct digit in the wrong position.
         * @param {number} secretNum - The secret three-digit number.
         * @param {number} guessNum - The guessed three-digit number.
         * @returns {{stars: number, hashes: number}} An object containing the counts.
         */
        function checkGuess(secretNum, guessNum) {
            let stars = 0;
            let hashes = 0;

            // Convert numbers to arrays of digits (as strings for easy comparison)
            const secretDigits = String(secretNum).split('');
            const guessDigits = String(guessNum).split('');

            // Create mutable copies for processing
            const secretCopy = [...secretDigits];
            const guessCopy = [...guessDigits];

            // First pass: Check for stars (correct digit and position)
            for (let i = 0; i < 3; i++) {
                if (guessCopy[i] !== null && guessCopy[i] === secretCopy[i]) {
                    stars++;
                    // Mark as 'used' to prevent double counting for hashes
                    secretCopy[i] = null;
                    guessCopy[i] = null;
                }
            }

            // Second pass: Check for hashes (correct digit, wrong position)
            for (let i = 0; i < 3; i++) {
                if (guessCopy[i] !== null) { // Only check if not already a star
                    const secretIndex = secretCopy.indexOf(guessCopy[i]);
                    if (secretIndex !== -1) {
                        hashes++;
                        secretCopy[secretIndex] = null; // Mark as 'used'
                    }
                }
            }
            return { stars, hashes };
        }

        /**
         * Displays a message to the user in the message box.
         * @param {string} message - The message to display.
         * @param {string} type - 'success' or 'error' to apply appropriate styling.
         */
        function displayMessage(message, type) {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden', 'message-success', 'message-error');
            if (type === 'success') {
                messageBox.classList.add('message-success');
            } else if (type === 'error') {
                messageBox.classList.add('message-error');
            } else {
                messageBox.classList.add('bg-blue-100', 'text-blue-800'); // Default info style
            }
        }

        /**
         * Clears the message box.
         */
        function clearMessage() {
            messageBox.classList.add('hidden');
            messageBox.textContent = '';
            messageBox.classList.remove('message-success', 'message-error', 'bg-blue-100', 'text-blue-800');
        }

        /**
         * Appends a guess and its result to the history display.
         * @param {number} guessNum - The guessed number.
         * @param {number} stars - The number of stars.
         * @param {number} hashes - The number of hashes.
         */
        function displayGuessHistory(guessNum, stars, hashes) {
            if (noHistoryMessage) {
                noHistoryMessage.classList.add('hidden'); // Hide "No history" message
            }

            const guessText = String(guessNum); // Convert number back to string for display
            let feedback = '';
            for (let i = 0; i < stars; i++) feedback += '⭐'; // Using emoji for stars
            for (let i = 0; i < hashes; i++) feedback += ' #'; // Using # for hashes

            const historyItem = document.createElement('div');
            historyItem.classList.add('history-item', 'text-gray-700', 'font-medium');
            historyItem.innerHTML = `
                <span>Attempt ${attempts}: <strong>${guessText}</strong></span>
                <span>${feedback || 'No match'}</span>
            `;
            historyDiv.prepend(historyItem); // Add to top of history
            historyDiv.scrollTop = 0; // Scroll to top to show latest guess
        }

        /**
         * Starts a new game: generates secret numbers, resets attempts, clears history and messages.
         */
        function startGame() {
            secretCombination = generateSecretCombination();
            attempts = 0;
            historyDiv.innerHTML = '<p id="noHistoryMessage" class="text-gray-500">No attempts yet. Start guessing!</p>';
            clearMessage();
            guessInput.value = ''; // Clear input field
            guessInput.disabled = false; // Enable input
            guessInput.focus(); // Focus on the input
            guessButton.disabled = false; // Enable guess button
            // console.log("Secret combination for debug (remove in production):", secretCombination); // For debugging, shows the secret
        }

        /**
         * Handles the user's guess submission.
         */
        function handleGuess() {
            clearMessage(); // Clear previous messages

            const guessValue = guessInput.value;
            const guessNum = parseInt(guessValue);

            // Validation: check if it's a 3-digit number between 100 and 999
            if (isNaN(guessNum) || guessValue.length !== 3 || guessNum < 100 || guessNum > 999) {
                displayMessage('Please enter a valid three-digit number (100-999).', 'error');
                return;
            }

            attempts++; // Increment attempt counter

            const { stars, hashes } = checkGuess(secretCombination, guessNum);

            displayGuessHistory(guessNum, stars, hashes);

            // Clear input field after guess
            guessInput.value = '';
            guessInput.focus(); // Focus on the input for next guess

            if (stars === 3) { // 3 stars means all digits are correct and in correct positions
                displayMessage(`Congratulations! You've won in ${attempts} attempts! The secret number was ${secretCombination}.`, 'success');
                guessInput.disabled = true; // Disable input
                guessButton.disabled = true; // Disable guess button
            } else {
                // Optional: Check for max attempts
                // if (MAX_ATTEMPTS && attempts >= MAX_ATTEMPTS) {
                //     displayMessage(`Out of attempts! The secret number was ${secretCombination}.`, 'error');
                //     guessInput.disabled = true;
                //     guessButton.disabled = true;
                // }
            }
        }

        // Event Listeners
        guessButton.addEventListener('click', handleGuess);
        newGameButton.addEventListener('click', startGame);

        // Allow pressing Enter key to submit guess when input is focused
        guessInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                handleGuess();
            }
        });

        // Initialize the game when the page loads
        window.onload = startGame;
    </script>
</body>
</html>
